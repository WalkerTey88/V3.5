<!DOCTYPE html><html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>龍兴记ᝰ云吞面 · 点单系统 (V3.5 Final)</title>
  <style>
    body{background:#740c10;color:#ffeecf;font-family:"Noto Sans SC",sans-serif;margin:0;padding:10px}
    .cat{border:1.5px dashed #f5d78a;border-radius:12px;margin:10px 0;padding:10px}
    .item{border:1.5px solid #f5d78a;border-radius:10px;padding:8px;margin:6px 0;background:rgba(255,255,255,.06)}
    .price{font-weight:900;color:#f7e7bb}
    .act{display:flex;align-items:center;gap:8px;margin-top:6px}
    .btn{border:1.5px solid #f5d78a;border-radius:10px;padding:4px 10px;background:#ffd86b;color:#5a3b00;cursor:pointer;font-weight:900}
    .btn.ghost{background:transparent;color:#ffeecf}
    .qty{min-width:24px;text-align:center}
    .extra{font-size:12px;margin-top:4px;display:flex;align-items:center;gap:6px}
  </style>
</head>
<body>
  <div id="cats"></div>
  <div style="margin-top:14px">
    <label>桌号</label><input id="tableNo" placeholder="01/02/打包">
    <label>备注</label><input id="note" placeholder="少甜/少冰/加奶">
    <button class="btn" id="checkoutBtn">结单</button>
  </div>
  <script>
  let CART=[];
  async function loadMenu(){
    const res=await fetch("https://script.google.com/macros/s/你的部署ID/exec?ts="+Date.now());
    let data=await res.json();
    data.sort((a,b)=>Number(a.order)-Number(b.order));
    renderMenu(data);
  }function renderMenu(data){ const cats={}; data.forEach(r=>{if(!cats[r.key])cats[r.key]=[];cats[r.key].push(r);}); const catsEl=document.getElementById('cats'); catsEl.innerHTML=''; Object.keys(cats).forEach(key=>{ const wrap=document.createElement('div');wrap.className='cat';wrap.innerHTML=<h3>${key}</h3>; const grid=document.createElement('div'); if(key==='cat_drinks'){renderDrinks(cats[key],grid);}else{ cats[key].forEach(it=>{ const div=document.createElement('div');div.className='item'; div.innerHTML=<h4>${it.name}</h4><div class="price">RM ${Number(it.price).toFixed(2)}</div>${key==='cat_juice'?<div class="extra"><label><input type="checkbox" data-milk="${it.name}"> 加奶</label></div>:''}${renderAct(it)}; grid.appendChild(div); }); } wrap.appendChild(grid); catsEl.appendChild(wrap); }); bindQtyButtons(); }

function renderDrinks(items,grid){ const groups={}; items.forEach(it=>{ const m=it.name.match(/^([\u4e00-\u9fa5A-Za-z ]+?)(?:\s?(C|O|咸C))?（(热|冰)）$/); if(!m)return;const base=m[1].trim(),variant=m[2]||'默认',temp=m[3]; groups[base]=groups[base]||{};groups[base][variant]=groups[base][variant]||{hot:null,ice:null}; if(temp==='热')groups[base][variant].hot=it;if(temp==='冰')groups[base][variant].ice=it; }); Object.keys(groups).forEach(base=>{ const card=document.createElement('div');card.className='item';card.innerHTML=<h4 style="cursor:pointer">${base}</h4>; const body=document.createElement('div');body.style.display='none'; Object.keys(groups[base]).forEach(v=>{ const node=groups[base][v];const title=(v==='默认')?base:${base} ${v}; body.insertAdjacentHTML('beforeend', <div style="border:1px dashed #f5d78a;border-radius:8px;padding:6px;margin:4px 0"> <div style="font-weight:800">${title}</div> <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px"> <div><div>热</div><div class="price">RM ${node.hot?Number(node.hot.price).toFixed(2):'—'}</div>${renderAct(node.hot)}</div> <div><div>冰</div><div class="price">RM ${node.ice?Number(node.ice.price).toFixed(2):'—'}</div>${renderAct(node.ice)}</div> </div> </div>); }); card.appendChild(body); card.querySelector('h4').onclick=()=>{body.style.display=body.style.display==='none'?'block':'none';}; grid.appendChild(card); }); }

function renderAct(it){if(!it)return'';const id=${it.name}__${it.price};return <div class="act"><button class="btn ghost" data-sub='${id}'>-1</button><div class="qty" data-qty='${id}'>0</div><button class="btn" data-add='${id}'>+1</button></div>;}

function bindQtyButtons(){ document.querySelectorAll('[data-add]').forEach(b=>b.onclick=()=>updateCart(b.getAttribute('data-add'),1)); document.querySelectorAll('[data-sub]').forEach(b=>b.onclick=()=>updateCart(b.getAttribute('data-sub'),-1)); } function updateCart(id,delta){ const [name,price]=id.split('__'); let item=CART.find(x=>x.name===name); if(!item&&delta>0)CART.push({name,price:Number(price),qty:1}); else if(item){item.qty+=delta;if(item.qty<=0)CART=CART.filter(x=>x!==item);} syncQty(); } function syncQty(){document.querySelectorAll('.qty').forEach(q=>q.textContent='0');CART.forEach(it=>{const q=document.querySelector([data-qty="${it.name}__${it.price}"]);if(q)q.textContent=it.qty;});}

async function submitOrder(){ if(!CART.length)return alert('未选择品项'); const table=document.getElementById('tableNo').value||'-'; const note=document.getElementById('note').value||''; const total=CART.reduce((s,it)=>s+it.qty*it.price,0); const orderObj={table:table,type:'堂食',note:note,total:Number(total.toFixed(2)),items:CART}; try{ await fetch("https://script.google.com/macros/s/你的部署ID/exec",{method:'POST',body:JSON.stringify(orderObj)}); }catch(e){console.error('同步订单失败',e);} const lines=[【龍运轩ᝰ美食中心】下单,桌号: ${table},—— 明细 ——,...CART.map(it=>${it.name} ×${it.qty} RM ${(it.qty*it.price).toFixed(2)}),合计: RM ${total.toFixed(2)}${note? · 备注:${note}:''}]; location.href=https://wa.me/?text=${encodeURIComponent(lines.join('\n'))}; CART=[];syncQty();document.getElementById('note').value=''; }

document.getElementById('checkoutBtn').onclick=submitOrder; document.addEventListener('DOMContentLoaded',loadMenu); </script>

</body>
</html>
